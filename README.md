# Veramo를 이용한 DID 흐름 구현

이 프로젝트는 Veramo 프레임워크를 사용하여 분산 신원 확인(DID) 및 검증 가능한 자격 증명(VC)의 기본적인 흐름을 클라이언트-서버 아키텍처 관점에서 보여줍니다. `did:key`와 `did:web` 두 가지 DID 메소드에 대한 구현을 제공합니다.

## 흐름

1.  **Veramo 에이전트 생성**: 클라이언트와 서버 각각 필요한 플러그인으로 Veramo 에이전트를 설정합니다.
2.  **DID 생성**: 서버는 발급자(issuer) DID를 생성하고, 클라이언트는 보유자(holder) DID를 생성합니다. (각 DID 메소드에 따라 `did:key` 또는 `did:web` 사용)
3.  **검증 가능한 자격 증명(VC) 발급**: 클라이언트가 서버에 자신의 DID를 보내 VC를 요청하고, 서버는 VC를 발급하여 클라이언트에게 전송합니다.
4.  **검증 가능한 프레젠테이션(VP) 생성**: 클라이언트는 수신한 VC를 사용하여 VP를 생성합니다.
5.  **VP 검증**: 클라이언트는 생성된 VP를 서버로 전송하고, 서버는 VP를 검증하여 결과를 클라이언트에게 반환합니다.

## 설치

프로젝트를 실행하려면 먼저 다음 종속성을 설치해야 합니다.

```bash
npm install
```

## `did:key` 클라이언트-서버 아키텍처 실행

`did:key` 메소드를 사용하여 로컬에서 클라이언트와 서버 간의 DID 흐름을 시연합니다.

1.  **서버 시작**: 새 터미널을 열고 다음 명령어를 실행하여 서버를 시작합니다.

    ```bash
    node key/server.js
    ```

    서버는 Issuer DID를 출력하고 3000번 포트에서 수신 대기합니다.

2.  **클라이언트 실행**: 다른 터미널을 열고 다음 명령어를 실행하여 클라이언트를 실행합니다.

    ```bash
    node key/client.js
    ```

    클라이언트는 다음을 수행합니다:
    *   Holder DID를 생성합니다.
    *   서버에 자격 증명을 요청합니다.
    *   서버로부터 받은 자격 증명으로 프레젠테이션을 생성합니다.
    *   생성된 프레젠테이션을 서버에 보내 검증을 요청합니다.
    *   서버로부터 받은 검증 결과를 출력합니다.

## `did:web` 클라이언트-서버 아키텍처 실행 (로컬 시뮬레이션)

`did:web` 메소드를 사용하여 로컬에서 클라이언트와 서버 간의 DID 흐름을 시연합니다. `did:web`은 일반적으로 공개적으로 접근 가능한 웹 서버를 필요로 하지만, 이 예제에서는 로컬에서 이를 시뮬레이션합니다.

**주의**: `did:web`은 실제 환경에서 동작하려면 공개적으로 접근 가능한 도메인과 해당 도메인에 호스팅되는 `.well-known/did.json` 파일이 필요합니다. 이 예제는 로컬 개발 환경에서의 시연을 위한 것입니다.

1.  **서버 시작**: 새 터미널을 열고 다음 명령어를 실행하여 서버를 시작합니다.

    ```bash
    node web/server.js
    ```

    서버는 `did:web:localhost:3000` DID를 Issuer DID로 사용하며, `http://localhost:3000/.well-known/did.json` 경로에서 자체 DID 문서를 제공합니다.

2.  **클라이언트 실행**: 다른 터미널을 열고 다음 명령어를 실행하여 클라이언트를 실행합니다.

    ```bash
    node web/client.js
    ```

    클라이언트는 다음을 수행합니다:
    *   Holder DID를 생성합니다. (여기서는 `did:key`를 사용합니다. `did:web` 홀더를 구현하려면 클라이언트도 DID 문서를 호스팅해야 하므로 복잡성이 증가합니다.)
    *   서버에 자격 증명을 요청합니다.
    *   서버로부터 받은 자격 증명으로 프레젠테이션을 생성합니다.
    *   생성된 프레젠테이션을 서버에 보내 검증을 요청합니다.
    *   서버로부터 받은 검증 결과를 출력합니다.

## 예상 출력

두 시나리오 모두 클라이언트 스크립트를 실행하면 다음과 유사한 출력을 볼 수 있으며, 최종 `Verification result`는 `true`입니다.

```
Holder DID: did:key:z6Mki...
Requesting credential from server...
Credential received: { ... }
Presentation created: { ... }
Verifying presentation with server...
Verification result: { verified: true, ... }
```

`did:key` 메소드는 별도의 외부 시스템 없이 로컬에서 완벽하게 작동하며, `did:web` 로컬 시뮬레이션 또한 성공적으로 검증됩니다.
